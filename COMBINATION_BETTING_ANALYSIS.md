
---

## 🎯 시뮬레이션 결과

### LightGBM 모델로 연승/쌍승 예측

**방법**: 각 경주에서 예측 확률 상위 2마리 선택

| 베팅 방식 | 성공률 | 필요 배당 (Break-even) | 실제 배당 (추정) | 수익 가능? |
|-----------|--------|----------------------|-----------------|-----------|
| **연승** (순서 무관) | **15.01%** | **8.3배** | 30~50배 | 🤔 **가능?** |
| **쌍승** (순서 고려) | **7.92%** | **15.8배** | 100~300배 | 🤔 **가능?** |

### 📈 ROI 추정 (실제 배당 30배 가정)

**연승 베팅**:
```
ROI = (15.01% × 30 × 0.8) - 1
    = 3.60 - 1
    = +260% 🎉🎉🎉
```

---

## ⚠️ 하지만 현실은...

### 문제 1: 시장 효율성 (여전히 존재)

**연승/쌍승 시장도 효율적입니다:**

- 배당이 이미 대중의 예측을 반영
- 우리가 "15% 성공률"로 예측한 조합 → 시장도 비슷하게 평가
- 실제 배당은 우리 예측보다 **훨씬 낮을 것**

**예시**:
- 우리 모델: A-B 연승 확률 20%
- 시장: A-B 연승 배당 **5배** (= 1/20% 반영)
- ROI = (20% × 5 × 0.8) - 1 = **-20%** ❌

### 문제 2: 우리 데이터의 한계

**실제 연승/쌍승 배당이 없음:**
- 추정값(30~50배)은 근거 없음
- 실제는 훨씬 낮을 가능성 높음
- ROI 계산 불가능

### 문제 3: 예측 vs 실제 불일치

**우리 모델의 "Top 2 예측":**
- LightGBM 확률 상위 2마리 선택
- 실제 1, 2등과 15% 일치

**하지만**:
- 이것은 **백테스트** 결과
- 실전에서는 더 낮을 가능성
- Train/Test 분포 불일치 문제 (복승에서 이미 경험)

### 문제 4: 배당 조정 (Parimutuel System)

**한국 경마는 parimutuel 방식:**
1. 총 베팅 금액을 모음
2. 수수료(20%) 제외
3. 당첨자끼리 나눔

**결과**:
- 많은 사람이 베팅한 조합 → 배당 ↓
- 우리 모델이 선택하는 조합 → 대중도 선택할 가능성 ↑
- 실제 배당은 기대보다 낮음

---

## 🔍 실제 데이터로 검증 필요

### 필요한 추가 데이터

```python
# 현재 데이터
odds_win      # 단승 배당 ✓
odds_place    # 복승 배당 ✓

# 필요한 데이터
odds_quinella   # 연승 배당 ❌
odds_exacta     # 쌍승 배당 ❌
odds_trifecta   # 삼복승 배당 ❌
odds_quinella_place  # 복연승 배당 ❌
```

### 검증 방법

1. **연승/쌍승 배당 데이터 수집**
   - 과거 배당 크롤링
   - API 활용 (있다면)

2. **실제 ROI 계산**
   ```python
   roi = (성공률 × 실제_배당 × 0.8) - 1
   ```

3. **배당 범위별 분석**
   - 인기마 조합 vs 비인기마 조합
   - 배당대별 ROI 비교

---

## 💡 이론적 가능성: Kelly Criterion

### Kelly Criterion (켈리 공식)

**최적 베팅 비율 계산:**
```
f* = (p × b - 1) / (b - 1)

여기서:
- f*: 최적 베팅 비율
- p: 승률
- b: 배당 - 1
```

**예시: 연승 15% 성공, 배당 30배**
```
f* = (0.15 × 29 - 1) / 28
   = (4.35 - 1) / 28
   = 0.12 (12% 베팅)
```

**하지만**:
- 이것은 p가 **정확할 때만** 유효
- 우리 15%가 과대평가라면 → 파산

---

## 🎲 포트폴리오 베팅 전략

### 아이디어: 여러 베팅 방식 조합

**다각화로 리스크 분산:**

| 베팅 | 비중 | 성공률 | 배당 | 기댓값 |
|------|------|--------|------|--------|
| 복승 (안전) | 50% | 60% | 1.5배 | -28% |
| 연승 (중위험) | 30% | 15% | 30배 | +260% |
| 쌍승 (고위험) | 20% | 8% | 150배 | +860% |

**포트폴리오 ROI**:
```
= 0.5 × (-28%) + 0.3 × 260% + 0.2 × 860%
= -14% + 78% + 172%
= +236% 🎉
```

**문제**:
- 연승/쌍승 배당이 **실제로 30배, 150배**일 때만 가능
- 시장 효율적이면 훨씬 낮음
- 15%, 8% 성공률도 과대평가 가능성

---

## 🏁 결론

### ❌ 여전히 어려움

1. **데이터 부족**
   - 연승/쌍승 배당 없음
   - 실제 ROI 계산 불가능

2. **시장 효율성**
   - 연승/쌍승 시장도 효율적일 가능성 높음
   - 우리 예측 → 시장도 비슷하게 예측

3. **높은 수수료**
   - 20% 수수료는 여전히 존재
   - Break-even 조건 여전히 까다로움

4. **과대평가 위험**
   - 백테스트 15% → 실전 10%?
   - 배당 30배 → 실제 10배?
   - 모든 가정이 낙관적

### ✅ 시도해볼 가치

**만약 실제 배당 데이터를 구할 수 있다면:**

1. **연승/쌍승 배당 수집**
   - 과거 데이터 크롤링
   - 실시간 API 활용

2. **실제 ROI 검증**
   - 백테스트로 실제 수익 확인
   - 시뮬레이션 말고 real data

3. **Kelly Criterion 적용**
   - 최적 베팅 비율 계산
   - 리스크 관리

4. **라이브 테스트**
   - 소액으로 실전 테스트
   - Paper trading으로 검증

### 🎯 현실적 조언

**조합 베팅도 여전히 어려움:**
- 시장 효율성은 모든 베팅 방식에 적용
- 수수료 20%는 여전히 큰 장벽
- 데이터 없이는 검증 불가능

**하지만**:
- 복승보다는 가능성 **약간** 높음
- 배당이 충분히 높다면 수익 가능성 존재
- 실제 데이터로 검증 필수

**최종 답변**:
> 조합 베팅으로 시장을 이길 **가능성은 있지만**, 
> 실제 배당 데이터 없이는 **검증 불가능**합니다.
> 
> 복승(-26% ROI)보다는 나을 수 있지만,
> 여전히 **시장 효율성과 수수료**라는 큰 장벽이 존재합니다.

---

## 📊 추가 분석 가능성

### 1. 배당 데이터 수집

```python
# 크롤링 대상
- 한국마사회 공식 사이트
- 과거 배당 이력
- 연승, 쌍승, 삼복승 등

# 수집 항목
- 날짜, 경주번호
- 조합 (예: 1-3 연승)
- 실제 배당
- 총 베팅 금액
```

### 2. Arbitrage 탐지

```python
# 여러 시장 간 불일치 탐색
- 단승 × 단승 vs 연승 배당 비교
- 이론적 배당 vs 실제 배당
- 차익거래 기회 탐색
```

### 3. 머신러닝 개선

```python
# Multi-task Learning
- 동시에 여러 타겟 예측
- Top 1, Top 2, Top 3 동시 학습
- 순위 전체를 학습 (Rank Learning)
```

하지만 **모든 것의 전제: 실제 배당 데이터 필수!**
