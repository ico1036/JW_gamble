# 수익성 베팅 전략 분석 결과

## ⚠️ 핵심 결론: 장기적 수익 불가능

**Test Set (2024-12-15 ~ 2025-09-28, 4,767 경주) 백테스팅 결과:**

모든 전략에서 **손실 발생**. 한국 경마 시장은 극도로 효율적이며, 환급률 80-85%로 인해 장기적으로 수익이 불가능합니다.

---

## 테스트한 전략들

### 전략 1: 모든 경주 베팅 (Fixed ₩1,000)

**Odds Baseline:**
- 총 베팅: 362건 (₩361,600)
- 승리: 34건 (9.39%)
- 환급: ₩261,600
- **ROI: -27.65%**
- **최종 손실: -₩100,000 (-100%)**

**LightGBM:**
- 총 베팅: 362건
- 승리: 34건 (9.39%)
- **ROI: -27.65%** (Odds Baseline과 동일)
- **최종 손실: -₩100,000 (-100%)**

**결론:** 무작위 베팅은 27.65% 손실. 환급률 약 72.35% (이론적 80-85%보다 낮음)

---

### 전략 2: Positive Expected Value (EV > 0)

Expected Value 계산:
```
EV = (predicted_prob × odds) - 1
```

**Odds Baseline (EV > 0):**
- 총 베팅: **0건**
- 이유: 시장이 완벽하게 효율적, EV > 0인 경우 없음
- **ROI: 0%**
- **최종 손익: ±0**

**LightGBM (EV > 0):**
- 총 베팅: 295건 (₩294,900)
- 승리: 14건 (4.75%)
- 환급: ₩194,900
- **ROI: -33.91%**
- **최종 손실: -₩100,000 (-100%)**

**결론:**
- Odds Baseline: 시장 = 효율적, EV > 0 기회 없음
- LightGBM: 잘못된 예측으로 오히려 더 큰 손실

---

### 전략 3: 최적화된 EV Threshold

ROI를 최대화하는 threshold 탐색 (범위: -0.05 ~ 0.15)

**Odds Baseline (Optimal: EV > -0.05):**
- 총 베팅: 362건
- **ROI: -27.65%**
- **최종 손실: -₩100,000 (-100%)**

**LightGBM (Optimal: EV > -0.05):**
- 총 베팅: 295건
- **ROI: -33.91%**
- **최종 손실: -₩100,000 (-100%)**

**결론:** Threshold 최적화도 손실 방지 불가능

---

### 전략 4: Kelly Criterion (Dynamic Sizing)

Kelly Criterion:
```
kelly = (odds × prob - 1) / (odds - 1)
bet_size = bankroll × kelly × 0.25  # Quarter Kelly (보수적)
```

**Odds Baseline (Kelly 0.25):**
- 총 베팅: **0건**
- 이유: Kelly > 0인 경우 없음 (시장 효율성)
- **ROI: 0%**
- **최종 손익: ±0**

**LightGBM (Kelly 0.25):**
- 총 베팅: 504건 (₩262,667)
- 승리: 23건 (4.56%)
- 환급: ₩162,684
- **ROI: -38.06%**
- **최종 손실: -₩99,983 (-99.98%)**

**결론:** Kelly도 시장 효율성 앞에서 무력

---

## 배당률 범위별 분석

### Odds Baseline (시장 배당률 그대로)

| 배당률 범위 | 베팅 수 | 승률 | ROI | 총 베팅 | 총 환급 | 손실 |
|------------|--------|------|-----|---------|---------|------|
| **1-2배** | 141 | **51.06%** | **-18.30%** | ₩141,000 | ₩115,200 | -₩25,800 |
| 2-3배 | 250 | 37.20% | -7.76% | ₩250,000 | ₩230,600 | -₩19,400 |
| 3-5배 | 475 | 21.26% | -16.93% | ₩475,000 | ₩394,600 | -₩80,400 |
| 5-10배 | 943 | 11.66% | -15.54% | ₩943,000 | ₩796,500 | -₩146,500 |
| 10-20배 | 1,068 | 5.52% | -26.47% | ₩1,068,000 | ₩785,300 | -₩282,700 |
| 20-50배 | 1,259 | 2.14% | -31.10% | ₩1,259,000 | ₩867,500 | -₩391,500 |
| 50배+ | 631 | 0.48% | **-72.17%** | ₩631,000 | ₩175,600 | **-₩455,400** |

**핵심 발견:**
1. **1-2배당이 가장 적게 잃음** (-18.30%)
2. EDA에서 예측한 +2% edge는 **환급률 차감 후 -18%로 반전**
3. 환급률 효과: ~20% 손실 (1 - 0.80 = 0.20)
4. 고배당(50배+)은 **-72% ROI** (극도로 비효율)

### LightGBM (추가 특징 사용)

| 배당률 범위 | 평균 예측 확률 | 평균 EV | ROI |
|------------|---------------|---------|-----|
| 1-2배 | 16.37% | **-0.74** | -18.30% |
| 2-3배 | 15.78% | **-0.61** | -7.76% |
| 3-5배 | 15.13% | **-0.41** | -16.93% |
| 5-10배 | 13.40% | **-0.03** | -15.54% |
| 10-20배 | 12.04% | **+0.72** | -26.47% |
| 20-50배 | 10.25% | **+2.27** | -31.10% |
| 50배+ | 9.42% | **+6.05** | -72.17% |

**치명적 문제:**
- LightGBM의 EV 계산이 **완전히 잘못됨**
- 고배당에서 높은 EV 예측 (+6.05) → 실제로는 -72% ROI
- **모델이 시장보다 못함**

---

## 왜 돈을 벌 수 없는가?

### 1. 시장 효율성 (Market Efficiency)

**Odds Baseline의 EV > 0 베팅: 0건**
→ 시장이 이미 모든 정보를 완벽하게 반영
→ 배당률 = 실제 승률의 정확한 역수

**증거:**
- Odds Baseline ROC-AUC: 0.815 (매우 높음)
- 1-2배당 승률: 51.06% (implied prob ~50-100%)
- Spearman correlation: ρ = 0.519 (매우 강함)

### 2. 환급률 (Payout Rate)

한국 경마 환급률: **약 72-73%** (이론적 80-85%보다 낮음)

**계산:**
```
1-2배당 승률: 51.06%
1-2배당 평균: 1.61배
기댓값 = 0.5106 × 1.61 = 0.822 (이론적)
실제 ROI = -18.30%
실제 환급률 = 1 - 0.1830 = 81.70%

전체 평균:
모든 베팅 ROI = -27.65%
환급률 = 1 - 0.2765 = 72.35%
```

**경마장의 수수료: 약 27.65%**

### 3. 모델의 한계

**LightGBM이 Odds Baseline보다 나쁜 이유:**
1. **과적합 (Overfitting)**
   - 24개 특징 사용 → noise 증가
   - Train set에서는 좋아 보이지만 실전에서 실패

2. **잘못된 확률 추정**
   - 고배당에서 EV +6.05 예측 → 실제 -72% ROI
   - 저배당 저평가, 고배당 과대평가

3. **시장보다 나은 정보 없음**
   - 수천명의 배터가 이미 모든 정보 반영
   - 기수, 조련사, 과거 성적 등 모두 배당률에 포함됨

---

## 실전 조언

### ❌ 피해야 할 행동

1. **"모델이 EV > 0이라고 하니까 베팅"**
   - LightGBM EV 예측은 완전히 틀림
   - 고배당에서 EV +6.05 → 실제 -72% ROI

2. **"고배당에 소액 베팅으로 대박"**
   - 50배+ 베팅: -72% ROI
   - 승률 0.48% (100번 중 0-1번)
   - 기댓값: 대량 손실

3. **"Kelly Criterion으로 최적화"**
   - Kelly 계산에 사용하는 확률이 틀리면 의미 없음
   - 우리 모델의 확률 추정 = 신뢰 불가

### ✅ 그나마 덜 나쁜 전략

1. **1-2배당에만 베팅**
   - ROI: -18.30% (가장 적게 잃음)
   - 승률: 51.06%
   - 하지만 여전히 손실

2. **소액 오락용**
   - Bankroll의 1% 미만
   - 절대 "투자"가 아님
   - 재미를 위한 지출

3. **베팅하지 않기**
   - **가장 현명한 선택**
   - 경마장에 가되 구경만

---

## 최종 결론

### 수학적 진실

```
기댓값 = Σ (배당률 × 확률 - 1) × 베팅액
       = -27.65% × 베팅액
       = 장기적으로 27.65% 손실
```

### 실제 수익 가능성

**불가능 이유:**
1. ✅ 시장 효율성 극도로 높음 (ROC-AUC 0.815)
2. ✅ 환급률 72-73% (27% 수수료)
3. ✅ 추가 정보로도 시장을 이길 수 없음 (LightGBM -34% ROI)
4. ✅ EV > 0 기회 없음 (Odds Baseline 0건 베팅)

### 돈을 벌 수 있다고 주장하는 사람은?

1. **표본 크기가 작음** (운이 좋았음)
2. **Survival Bias** (진 사람은 말 안함)
3. **사기** (배팅 팁 판매 등)

---

## 실행 방법

```bash
# 수익성 분석 실행
uv run python train_profitable.py --data race_results.parquet --output-dir models_profitable
```

**출력 파일:**
- `profitability_results.json`: 모든 전략의 상세 결과
- `odds_baseline_by_range.csv`: 배당률 범위별 분석
- `lgbm_by_range.csv`: LightGBM 배당률 범위별 분석

---

## 참고 문헌

- **EDA_REPORT.md**: 탐색적 데이터 분석 (시장 효율성 발견)
- **MODEL_USAGE.md**: 모델 사용법
- **betting_strategy.py**: 베팅 시뮬레이션 코드

---

**생성일**: 2025-09-30
**데이터**: KRA 경마 결과 (2024-12-15 ~ 2025-09-28, 4,767 경주)
**결론**: **장기적 수익 불가능. The house always wins.**